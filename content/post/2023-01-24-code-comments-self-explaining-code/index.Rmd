---
slug: code-comments-self-explaining-code
title: "Why comment your code as little (and as well) as possible" 
authors: 
- Maëlle Salmon 
date: "2023-01-24" 
tags: 
- package development
- code style
output: hugodown::hugo_document
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(fig.path = "", comment = "")
# knitr hook to make images output use Hugo options
knitr::knit_hooks$set(
  plot = function(x, options) {
    hugoopts <- options$hugoopts
    paste0(
      "{{<figure src=",
      '"', x, '" ',
      if (!is.null(hugoopts)) {
        glue::glue_collapse(
          glue::glue('{names(hugoopts)}="{hugoopts}"'),
          sep = " "
        )
      },
      ">}}\n"
    )
  }
)

```

When I first started programming, I clearly remember feeling I had to add comments, that would repeat exactly what the code below was doing, as if it were the script for some sort of voice over.
I want you to know like I now do that it's not the way to comment one's code.
:sweat_smile:

An important goal of good code is to be readable so that future contributors can build with and upon it as needed.
Good commenting is part of the toolset for reaching that goal.
In this post we shall first present principles of code commenting, and then a few tips.

## Principles for commenting

Comment your code as little as possible.
:wink: Now, this does not mean to not care for readability and clarity at all, on the contrary.
Pack as much information as possible in the code itself.
For instance, naming one variable well can allow you to skip telling the reader what it is.

The tidyverse style guide states ["use comments to explain the"why" not the "what" or "how""](https://style.tidyverse.org/functions.html#comments-1).
The what and how should be deduced from your code.

In ["The Art of Readable Code"](https://www.goodreads.com/book/show/8677004-the-art-of-readable-code) by Dustin Boswell and Trevor Foucher, the chapter on knowing what to comment starts with the key idea "The purpose of commenting is to help the reader know as much as the writer did".

Code comments should be viewed as little flags, little alerts.
There should be as few of them as possible.
Otherwise, your reader will get used to ignoring them.
Furthermore, you'll get extremely bored writing them.
:zzz:

Code comments should not be used as a band-aid for bad code design.
If it's very difficult to explain a piece of code, possibly more time should be spent on said code.
Or, you could add a comment... "#TODO fix code debt".
:innocent:

## Tips for (not) commenting

### Name things well

Using concise but precise names will help make your code readable.
In the book [The Programmer Brain](https://www.goodreads.com/book/show/57196550-the-programmer-s-brain), Felienne Hermans presents Feitelson's three-step model for better variable names:

> "- Select the concepts to include in the name." "- Choose the words to represent each concept." "- Construct a name using these words."

Isn't this a life-changing tip?

### Use helper functions or explaining variables

The post ["Explaining variable"](https://blog.thepete.net/blog/2021/06/24/explaining-variable/) by Pete Hodgson (found thanks to a [tweet by Jenny Bryan](https://twitter.com/JennyBryan/status/1412140590842597385)) was truly eye opening for me so I recommend reading it.

The principle is to replace a piece of code with a well named Boolean variable for instance, or a function.

Here's an example with a function.
Instead of writing some code à la

```{r, eval=FALSE}
if (!is.na(x) && nzchar(x)) {
  use_string(x)
}
```

the idea is to write something like

```{r, eval=FALSE}
is_non_empty_string <- function(x) {
  !is.na(x) && nzchar(x)
}

if (is_non_empty_string(x)) {
  use_string(x)
}
```

where `is_non_empty_string()` could even be defined in a separate R script (called `utils-blabla.R` or so).

### Wrap external functions with a nicer interface

This is very related to the previous tip.
Say you want to use a function with an unclear name.
Do not hesitate to wrap it in a function with a better name if you think it'll improve readability.
(You can also use this technique to switch the argument order.)

```{r, eval=FALSE}
# in utils.R
remove_extension <- function(path) {
  tools::file_path_sans_ext(path)
}

# in other files
remove_extension(path)
```

### Think twice before adding a comment on your own PR

In my own experience, aspects I want to add in a line comment on a GitHub Pull Request are often prime content for actual code comments (or a reason for refactoring my code!).
It's not always true, but I try to pay attention to whether the comment should stay in the GitHub history only, or alongside the code.

### Have someone review your code

As much as you try to think about what a collaborator (or future you) would like to know when reading the code, it's handy to have an actual collaborator tell you where a comment might be warranted.
The collaborator might not ask for a comment, but they might ask a question whose answer should be tracked in the code.

## Conclusion

In this post, I explained why to comment your code as little (and as well!) as possible, with a few ideas of how to do that.
I'd really recommend reading ["The Art of Readable Code"](https://www.goodreads.com/book/show/8677004-the-art-of-readable-code) if you can get your hands on a copy.
Furthermore, unsurprisingly, practice helps, I myself need a lot more of it.
Feel free to comment :wink: with your own commenting tricks.
